var XMing=XMing||{};XMing.GameStateManager=new function(){var b;var d=0;var c;var f;var j=[{image:"images/egg.png",text:"egg",title:"I come first before chicken!",subtitle:"Some disagree."},{image:"images/chicken.png",text:"chicken",title:"I come first before egg!",subtitle:"Most agree."},{image:"images/mushroom.png",text:"mushroom",title:"Beware!",subtitle:"Mario's size doubles when consumed."},{image:"images/apple.png",text:"apple",title:"I fell on Newton's head",subtitle:"Snow White couldn't resist me!\nI bent."},{image:"images/banana.png",text:"banana",title:"Many fell as they slip on me",subtitle:"Minions love me!\nI split."},{image:"images/carrot.png",text:"carrot",title:'"I know nobody will see my status"',subtitle:'"but sometimes when I am bored, I go into the garden, I cover myself in earth and I pretend I am a ______."'},{image:"images/orange.png",text:"orange",title:"I am a colour. I am a fruit. The colour of the fruit is me.",subtitle:"This relationship is complicated."},{image:"images/batman.png",text:"batman",title:'In javascript: Array(16).join("lol" - 2)',subtitle:"NaNNaNNaNNaNNaNNaNNaNNaN\nNaNNaNNaNNaNNaNNaNNaN"},{image:"images/hellokitty.png",text:"hellokitty",title:"A cat without mouth",subtitle:"Never was a cat"},{image:"images/snoopy.png",text:"snoopy",title:"A dog (beagle)",subtitle:"Still a dog"},{image:"images/pig.png",text:"pig",title:"What is life?",subtitle:"Eat. Play. Sleep."},{image:"images/fish.png",text:"fish",title:"What is life?",subtitle:"Hunt the smaller ones.\nAvoid the bigger ones."}];var g=_.range(_.size(j));var e;var i=[];var a=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];var h={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};this.init=function(){window.addEventListener("resize",this.onResize.bind(this),false);this.initGame()};this.loadGrid=function(){var k=_.sample(g);g=_.without(g,k);i=[];e=j[k];var l=e.text.split("");l=_.shuffle(l.concat(_.sample(_.difference(a,l),16-l.length)));$(".game-grid").html("");_.each(l,function(m){$(".game-grid").append("<li><div class='content animated fadeIn'>"+m+"</li>")});this.onResize()};this.loadData=function(){var k=this;this.loadGrid();f=10.5;$("#timer-value").html(Math.floor(f)).removeClass("animated fadeIn");$("#image-to-guess").attr("src",e.image);swal({title:e.title,text:e.subtitle+"\n\n("+e.text.length+"-letter word)",imageUrl:e.image},function(){(function l(){f-=0.5;$("#timer-value").html(Math.ceil(f));$("#timer-value").addClass("animated fadeIn");$("#score-value").html(d);if(f<=0){clearTimeout(c);$("#result-content").html("Time's up!").addClass("animated bounceIn").css("color","rgba(17, 189, 255, 255)");$("#timer-value").removeClass("animated fadeIn");k.loadNextRound()}else{c=setTimeout(l,500)}})()});this.loadSelectedLetters();$("ul.game-grid li").click(function(){if($(this).hasClass("selected")){$(this).removeClass("selected");var m=$(this).attr("data-number");i.splice(m-1,1);_.each(_.filter($("ul.game-grid li"),function(n){return $(n).attr("data-number")>m}),function(n){$(n).attr("data-number",parseInt($(n).attr("data-number"))-1)});k.loadSelectedLetters()}else{if(i.length<e.text.split("").length){$(this).addClass("selected");var l=$(this.firstChild).html();i.push(l);$(this).attr("data-number",i.length);k.loadSelectedLetters();k.checkResult()}}})};this.loadSelectedLetters=function(){$(".game-letters span").remove();_.each(i,function(m){$(".game-letters").append("<span>"+m+"</span>")});var k=e.text.split("").length;var l=k-i.length;_.times(l,function(){$(".game-letters").append("<span>&nbsp;&nbsp;&nbsp;</span>")})};this.checkResult=function(){if(_.isEqual(i,e.text.split(""))){$("#result-content").html("Correct!").addClass("animated bounceIn").css("color","rgba(0, 255, 0, 255)");d+=f*10;$(".score-change").html("+"+f*10).css("color","rgba(0, 255, 0, 255)");$("#timer-value").removeClass("animated fadeIn");$("#score-value").html(d);$(".score-change").animate({top:"-25px"},{duration:1000,complete:function(){$(".score-change").html("").css("top","-10px")}});clearTimeout(c);this.loadNextRound()}else{if(i.length==e.text.split("").length){$(".game-letters").addClass("animated shake answer-wrong");$(".game-letters").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated shake answer-wrong")})}}};this.loadNextRound=function(){var k=this;var l=$("ul.game-grid");$("#result").width(l.width()).height(l.height()).show();_.delay(function(){$("#result").hide();if(_.size(g)>0){k.loadData()}else{k.endGame()}},1000)};this.onResize=function(n){var l=$(".game-grid").children("li");var k=_.max(l,function(o){return $(o).width()});var m=$(k).width();_.each(l,function(o){$(o).height(m)})};this.preloadImage=function(){_.each(j,function(m){var l=new Image();l.src=m.image});var k=new Image();k.src="images/love.png"};this.initGame=function(){b=h.INITIAL;this.preloadImage();var k=this;$(".icon-repeat").click(function(){k.startGame()})};this.startGame=function(){b=h.START;d=0;g=_.range(_.size(j));$("#timer").show();$("#replay").hide();this.loadData()};this.endGame=function(){b=h.END;var k=this;$("#image-to-guess").attr("src","images/word-grid.png");i=[];e={image:"images/word-grid.png",text:"GAMELOVER"};this.loadSelectedLetters();$(".game-grid").html("");var l=["G","A","M","E","O","V","E","R","L"];_.times(7,function(){l.push("#")});_.each(_.shuffle(l),function(m){$(".game-grid").append("<li><div class='content animated fadeIn'>"+m+"</li>")});$("#timer").hide();$("#replay").show();$("#score-value").html(d);this.onResize();swal({title:"Congratulations!",text:"Your score is "+d+"! :D",imageUrl:"images/word-grid.png"});$("ul.game-grid li").click(function(){if($(this).hasClass("selected")){$(this).removeClass("selected");var n=$(this).attr("data-number");i.splice(n-1,1);_.each(_.filter($("ul.game-grid li"),function(o){return $(o).attr("data-number")>n}),function(o){$(o).attr("data-number",parseInt($(o).attr("data-number"))-1)});k.loadSelectedLetters()}else{if(i.length<e.text.split("").length){$(this).addClass("selected");var m=$(this.firstChild).html();i.push(m);$(this).attr("data-number",i.length);k.loadSelectedLetters();if(_.isEqual(i,e.text.split(""))){swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"})}else{if(i.length==e.text.split("").length){$(".game-letters").addClass("animated shake answer-wrong");$(".game-letters").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated shake answer-wrong")})}}}}})};this.isGameStateInitial=function(){return b==h.INITIAL};this.isGameStateStart=function(){return b==h.START};this.isGameStateEnd=function(){return b==h.END}};