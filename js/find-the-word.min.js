var XMing=XMing||{};XMing.GameStateManager=new function(){var e=0;var t;var n;var r;var i=0;var s=[{image:"images/egg.png",text:"egg",title:"I come first before chicken!",subtitle:"Some disagree."},{image:"images/chicken.png",text:"chicken",title:"I come first before egg!",subtitle:"Most agree."},{image:"images/mushroom.png",text:"mushroom",title:"Beware!",subtitle:"Mario's size doubles when consumed."},{image:"images/apple.png",text:"apple",title:"I fell on Newton's head",subtitle:"Snow White couldn't resist me!\nI bent."},{image:"images/banana.png",text:"banana",title:"Many fell as they slip on me",subtitle:"Minions love me!\nI split."},{image:"images/carrot.png",text:"carrot",title:"Me!",subtitle:"or stick?"},{image:"images/orange.png",text:"orange",title:"A colour\nA fruit",subtitle:"The colour is the fruit.\nThe fruit is the colour."},{image:"images/hellokitty.png",text:"hellokitty",title:"A cat without mouth",subtitle:"Never was a cat"},{image:"images/snoopy.png",text:"snoopy",title:"A dog (beagle)",subtitle:"Confirmed by Peanuts"},{image:"images/pig.png",text:"pig",title:"What is life?",subtitle:"Eat. Play. Sleep."},{image:"images/fish.png",text:"fish",title:"Survival tips",subtitle:"Hunt the smaller ones.\nAvoid the bigger ones."}];var o=_.range(_.size(s));var u;var a=[];var f;var l=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];var c={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};this.init=function(){window.addEventListener("resize",this.onResize.bind(this),false);this.initGame()};this.loadGrid=function(){var e=_.sample(o);o=_.without(o,e);a=[];u=s[e];var t=u.text.split("");t=_.shuffle(t.concat(_.sample(_.difference(l,t),16-t.length)));$(".game-grid").html("");_.each(t,function(e){$(".game-grid").append("<li><div class='content animated fadeIn'>"+e+"</li>")})};this.loadData=function(){var e=this;this.loadGrid();r=10.5;$("#timer-value").html(Math.floor(r)).removeClass("animated fadeIn");$("#image-to-guess").attr("src",u.image);swal({title:u.title,text:u.subtitle+"\n\n("+u.text.length+"-letter word)",imageUrl:u.image},function(){(function t(){r-=.5;$("#timer-value").html(Math.ceil(r));$("#timer-value").addClass("animated fadeIn");$("#score-value").html(i);if(r<=0){clearTimeout(n);$("#result-content").html("Time's up!").addClass("animated bounceIn").css("color","rgba(17, 189, 255, 255)");$("#timer-value").removeClass("animated fadeIn");e.loadNextRound()}else{n=setTimeout(t,500)}})()});this.loadSelectedLetters();$("ul.game-grid li").click(function(){if($(this).hasClass("selected")){$(this).removeClass("selected");var t=$(this).attr("data-number");a.splice(t-1,1);_.each(_.filter($("ul.game-grid li"),function(e){return $(e).attr("data-number")>t}),function(e){$(e).attr("data-number",parseInt($(e).attr("data-number"))-1)});e.loadSelectedLetters()}else{if(a.length<u.text.split("").length){$(this).addClass("selected");var n=$(this.firstChild).html();a.push(n);$(this).attr("data-number",a.length);e.loadSelectedLetters();e.checkResult()}}})};this.loadSelectedLetters=function(){$(".game-letters span").remove();_.each(a,function(e){$(".game-letters").append("<span>"+e+"</span>")});var e=u.text.split("").length;var t=e-a.length;_.times(t,function(){$(".game-letters").append("<span>&nbsp;&nbsp;&nbsp;</span>")})};this.checkResult=function(){if(_.isEqual(a,u.text.split(""))){$("#result-content").html("Correct!").addClass("animated bounceIn").css("color","rgba(0, 255, 0, 255)");i+=r*10;$(".score-change").html("+"+r*10).css("color","rgba(0, 255, 0, 255)");$("#timer-value").removeClass("animated fadeIn");$("#score-value").html(i);$(".score-change").animate({top:"-25px"},{duration:1e3,complete:function(){$(".score-change").html("").css("top","-10px")}});clearTimeout(n);this.loadNextRound()}else{if(a.length==u.text.split("").length){$(".game-letters").addClass("animated shake answer-wrong");$(".game-letters").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated shake answer-wrong")})}}};this.loadNextRound=function(){var e=this;var t=$("ul.game-grid");$("#result").width(t.width()).height(t.height()).show();_.delay(function(){$("#result").hide();if(_.size(o)>0){e.loadData()}else{e.endGame()}},1e3)};this.onResize=function(t){if($(window).width()!=e){e=$(window).width();if(f){f.html("")}var n=$(".game-grid").children("li");var r=_.max(n,function(e){return $(e).width()});var i=$(r).width();var s="<style>";s+=" ul.game-grid { width: "+i*4+"px; } ";s+=" .game-grid li { height: "+i+"px; width: "+i+"px; } ";s+=" .game-grid li .content { font-size: "+i*.5+"px; } ";s+=" #result-content { font-size: "+i*.8+"px; } ";s+=" .game-letters span { font-size: "+i*.2+"px; margin-left: "+i*.1+"px; } ";s+="</style>";if(f){f.html(s)}else{f=$("<div />",{html:s}).appendTo("body")}}};this.preloadImage=function(){_.each(s,function(e){var t=new Image;t.src=e.image});var e=new Image;e.src="images/love.png"};this.initGame=function(){t=c.INITIAL;this.preloadImage();var e=this;$(".icon-repeat").click(function(){e.startGame()})};this.startGame=function(){t=c.START;i=0;o=_.range(_.size(s));$("#timer").show();$("#replay").hide();e=0;this.onResize();this.loadData()};this.endGame=function(){t=c.END;var e=this;$("#image-to-guess").attr("src","images/word-grid.png");a=[];u={image:"images/word-grid.png",text:"GAMELOVER"};this.loadSelectedLetters();$(".game-grid").html("");var n=["G","A","M","E","O","V","E","R","L"];_.times(7,function(){n.push("#")});_.each(_.shuffle(n),function(e){$(".game-grid").append("<li><div class='content animated fadeIn'>"+e+"</li>")});$("#timer").hide();$("#replay").show();$("#score-value").html(i);swal({title:"Congratulations!",text:"Your score is "+i+"! :D",imageUrl:"images/word-grid.png"});$("ul.game-grid li").click(function(){if($(this).hasClass("selected")){$(this).removeClass("selected");var t=$(this).attr("data-number");a.splice(t-1,1);_.each(_.filter($("ul.game-grid li"),function(e){return $(e).attr("data-number")>t}),function(e){$(e).attr("data-number",parseInt($(e).attr("data-number"))-1)});e.loadSelectedLetters()}else{if(a.length<u.text.split("").length){$(this).addClass("selected");var n=$(this.firstChild).html();a.push(n);$(this).attr("data-number",a.length);e.loadSelectedLetters();if(_.isEqual(a,u.text.split(""))){swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"})}else{if(a.length==u.text.split("").length){$(".game-letters").addClass("animated shake answer-wrong");$(".game-letters").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated shake answer-wrong")})}}}}})};this.isGameStateInitial=function(){return t==c.INITIAL};this.isGameStateStart=function(){return t==c.START};this.isGameStateEnd=function(){return t==c.END}}